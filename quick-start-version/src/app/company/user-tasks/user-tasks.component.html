<app-card [hidHeader]="'true'" class="col-lg-12" cardClass="task-board-left">
    <div class="col-sm-12 row">
        <button *ngFor="let btn of lstNotesTypes" class="btn" (click)="clickNoteType(btn.value)" [ngClass]="[btn.isActive ? btn.activeColor : btn.disActiveColor]" type="button">
          {{btn.label}}
      </button>
    </div>
</app-card>


<app-card [customHeader]="true" blockClass="task-comment" [options]="false" *ngIf="!noteToHistoryId" IloadCard='{{loadCard}}'>
    <div class="app-card-header">
        <h5 class="card-header-text"><i class="fas fa-plus m-r-5"></i> Tasks</h5>
    </div>
    <ul class="media-list p-0">
        <li class="media" *ngFor="let note of lstNotes| paginate: {id:paggingManager.id, itemsPerPage: paggingManager.itemsPerPage, currentPage: paggingManager.currentPage, totalItems: paggingManager.totalItems } ; let i = index ">
            <div class="media-left mr-3">
                <a>
                    <img class="media-object img-radius comment-img" [src]="'./attachment/' + note.userpicture" alt=" ">
                </a>
            </div>
            <div class="media-body">

                <div class="d-flex justify-content-between">
                    <h6 class="media-heading txt-primary">{{note.fromContactName}} - <a class="text-c-red" href="javascript:" (click)="openorder(note.orderId)">order by {{note.orderSupplierName}}</a> </h6>

                    <h6>
                        <button type="button" class="btn btn-outline-success " style="padding: 3px;" *ngIf="note.allowToMakeAssign && note.type != 1 && note.type != 3" (click)="MakeNoteAsDone(note.id)">Make As Done</button>
                        <button type="button" class="btn btn-outline-danger " style="padding: 3px;" *ngIf="note.allowToMakeUndoDone && note.type != 1 && note.type != 3" (click)="UndoDone(note.id)">Undo Done</button>
                        <span class="label label-success " *ngIf="note.doneByName"> done by: {{note.doneByName}}</span>
                        <strong>{{note.createdAt | dateAgo}} </strong> |
                        <span class="f-12 m-l-5">{{note.createdAt | date:'yyyy-MM-dd,h:mm a'}}</span>
                    </h6>
                </div>

                <div [innerHTML]="note.content" class="w-100 content" *ngIf="!note.editable"></div>
                <app-tinymce class="col-sm-12" [(ngModel)]="note.content" #tinymce='tinymce' *ngIf="note.editable">
                </app-tinymce>

                <div class="m-t-10 m-b-25 d-flex justify-content-end" *ngIf="note.editable && note.allowToEdit">
                    <button class="btn btn-outline-primary" (click)="updateNote(note.id)">Edit</button>
                </div>

                <div class="m-t-10 m-b-25" *ngIf="!note.editable">
                    <span><a class="m-r-10 text-secondary" (click)="openCloseReplay(note.id,true)">Reply</a></span>
                    <span *ngIf="note.allowToEdit" (click)="note.editable = true"><a
                          class="m-r-10 text-secondary">Edit</a> </span>

                    <strong class="m-r-10 text-primary cursor" *ngIf="note.updatedAt" (click)="openHistory(note.id)">
                      History </strong>

                </div>
                <div class="m-b-25" *ngIf="!note.editable">
                    <ul>
                        <li *ngFor="let attach of note.attachments">{{attach.name}} <a [href]="attach.url" target="_blank"><i class="fas fa-download f-18 mx-5" ></i></a> </li>
                    </ul>

                </div>
                <hr style="border:1px solid #3F4D67">
                <div class="media mt-2" *ngFor="let subn of note.lstReplays">
                    <a class="media-left mr-3">
                        <img class="media-object img-radius comment-img" [src]="'./attachment/' + subn.userpicture" alt=" ">
                    </a>
                    <div class="media-body">
                        <div class="d-flex justify-content-between">
                            <h6 class="media-heading txt-primary">{{subn.fromContactName}} </h6>
                            <h6>
                                <strong>{{subn.createdAt | dateAgo}} </strong> |
                                <span class="f-12 m-l-5">{{subn.createdAt | date:'yyyy-MM-dd,h:mm:ss a'}}</span>
                            </h6>
                        </div>
                        <div [innerHTML]="subn.content" class="w-100 content" *ngIf="!subn.editable"></div>
                        <app-tinymce class="col-sm-12" [(ngModel)]="subn.content" #tinymce='tinymce' *ngIf="subn.editable">
                        </app-tinymce>

                        <div class="m-t-10 m-b-25 d-flex justify-content-end" *ngIf="subn.editable && subn.allowToEdit">
                            <button class="btn btn-outline-primary" (click)="updateNote(subn.id,true)">Edit</button>
                        </div>

                        <div class="m-t-10 m-b-25" *ngIf="!subn.editable">
                            <span *ngIf="subn.allowToEdit" (click)="subn.editable = true"><a
                                  class="m-r-10 text-secondary">Edit</a>
                          </span>
                            <strong class="m-r-10 text-primary cursor" *ngIf="subn.updatedAt" (click)="openHistory(subn.id)"> History </strong>

                        </div>
                        <hr>
                    </div>
                </div>


                <div class="media mt-2" *ngIf="note.active_replay">
                    <a class="media-left mr-3">
                        <img class="media-object img-radius comment-img" src="assets/images/user/avatar-2.jpg" alt=" ">
                    </a>
                    <div class="media-body">
                        <h6 class="media-heading txt-primary">New Replay</h6>
                        <p>
                            <app-tinymce class="col-sm-12" [(ngModel)]="replayText" #tinymce='tinymce'></app-tinymce>
                        </p>
                        <div class="m-t-10 m-b-25 d-flex justify-content-end">
                            <button class="btn btn-outline-danger" (click)="note.active_replay = false; replayText=''">Cancel</button>
                            <button class="btn btn-outline-primary" (click)="makeReplay(note.id)">Reply</button>
                        </div>
                        <hr>
                    </div>
                </div>
            </div>
        </li>
    </ul>


    <div class="nav-item nav-grid w-100 d-flex justify-content-end">
        <pagination-controls id="notespaging" (pageChange)="pageChanged($event)" (pageBoundsCorrection)="pageChanged($event)" maxSize="9" directionLinks="true" autoHide="false" responsive="true" previousLabel="Previous" nextLabel="Next" screenReaderPaginationLabel="Pagination"
            screenReaderPageLabel="page" screenReaderCurrentLabel="You're on page">
        </pagination-controls>
    </div>
</app-card>




<app-card [hidHeader]="'true'" class="col-lg-12" cardClass="task-board-left" *ngIf="noteToHistoryId" IloadCard='{{loadCard}}'>
    <div class="card" *ngIf="noteHistoryContent">
        <div class="card-block">
            <div class="row align-items-center justify-content-center">
                <div class="col-auto">
                    <img class="img-fluid rounded-circle" style="width:70px;" src="assets/images/user/avatar-2.jpg" alt="dashboard-user">
                </div>
                <div class="col">
                    <h5>{{noteHistoryContent.latestvalue.userName}}</h5>
                </div>
            </div>
            <ul class="task-list">
                <li>
                    <i class="task-icon bg-c-green"></i>
                    <h6><span class="float-right">{{noteHistoryContent.latestvalue.createdAt | date:'yyyy-MM-dd | h:mm:ss a'}}</span>
                    </h6>
                    <div [innerHTML]="noteHistoryContent.latestvalue.content" class="mt-2"></div>
                </li>
                <li *ngFor="let ch of noteHistoryContent.lstChanges">
                    <i class="task-icon bg-c-green"></i>
                    <h6><span class="float-right">{{ch.createdAt| date:'yyyy-MM-dd | h:mm:ss a'}}</span></h6>
                    <div [innerHTML]="ch.content" class="mt-2"></div>
                </li>
            </ul>
        </div>
    </div>
    <button class="btn btn-outline-danger" (click)="noteToHistoryId = undefined">Cancel</button>

</app-card>